#include <stdio.h>
#include <stdlib.h>
#include<time.h>
int main(int argc, char *argv[]) {
	 
	login();
	return 0;
}
//登录函数
void login()
{   
	
	while(1)
	{	 
		srand(time(0));
	    int number=rand();
	    srand(number);
	    int number2= rand()%1000+1234;
		//验证码的随机生成
		
		char username[20];
	 	char password[20];
	 	int zz;//用户输入的验证码 
		//只有3次输入错误的机会 
		
	
		printf("请输入用户名:");
		scanf("%s",username);
		printf("请输入密码：");
		scanf("%s",password); 
		printf("验证码为：%d\n",number); 
		printf("请输入以上验证码；"); 
		scanf("%d",&zz);
		if(strcmp(username,"Liujehong")==0&&strcmp(password,"123456")==0&&zz==number)//比较密码验证码 
		{
			menu();
		}
		else
		{
			logtest();
			
		}
	}
	
				
		
	
 } 
//菜单函数
void menu()
{   
	int flag;
	while(1)
	{   system("cls");
		printf("------------------------------------------\n");
		printf("-----成都师范学院学生成绩管理系统v1.1-----\n");
		printf("|       1.查询数据        2.增加数据     |\n");
		printf("|       3.修改数据        4.删除数据     |\n");
		printf("|                                        |\n");
		printf("|               -0.退出系统-             |\n");
		printf("------------------------------------------\n");
		printf("-------------技术支持：Liujehong----------\n");
		printf("------------------------------------------\n");
		printf("请输入你要进行的操作序号。"); 
		scanf("%d",&flag); 
		switch(flag)
		{
			case 1:foread();break;
			case 2:foadd();break;
			case 3:break;
			case 4:deldate();break; 
		}
		if(flag==0)
		{
			break;
			
		 } 
	 } 
	 	
 } 
 //增加数据 学生姓名 学号 语文 数学 英语 
 void foadd()
 {  
 	char stuname[20];
 	char stuid[20];
 	char stuchinese[20];
 	char stumath[20];
 	char stuenglish[20];
 	int  flag;
 	
 	system("cls");
 	
	 	FILE *fp;
	 	if((fp=fopen("d:/score.txt","a"))==NULL)
	 	{
	 		printf("打开错误！"); 
	 		system("pause");
	 		exit(0);
		 }	 
	while(1)
 	{  	
	 	printf("请输入姓名:");
		scanf("%s",stuname);
		printf("请输入学号:");
		scanf("%s",stuid); 
		printf("请输入语文成绩:");
		scanf("%s",stuchinese); 
		printf("请输入数学成绩:");
		scanf("%s",stumath);
		printf("请输入英语成绩：");
		scanf("%s",stuenglish);
		fprintf(fp,"%s %s %s %s %s\n",stuname,stuid,stuchinese,stumath,stuenglish);
		printf("增加成功");	
		printf("是否继续录入：是（1)/否（0）");
		scanf("%d",&flag);
		if(flag==0)
		{   
			break;
			
		}
		
		
		
	}
	system("cls");
	fclose(fp);
}

void foread()//读取数据 
{
	char stuname[20];
 	char stuid[20];
 	char stuchinese[20];
 	char stumath[20];
 	char stuenglish[20];
 	int flag;//判断是否使用平均分的变量 
 	
 	system("cls");
 	FILE *fp;
	if((fp=fopen("d:/score.txt","r"))==NULL)
	{
	 	printf("打开错误！"); 
	 	system("pause");
	 	exit(0);
	}   
	//格式化输出
	printf("%-10s%-15s%-10s%-10s%-10s\n\n","姓名","学号","语文","数学","英语");  
	while(1)
	{
		  
		while(fscanf(fp,"%s %s %s %s %s\n\n",stuname,stuid,stuchinese,stumath,stuenglish)!=EOF)
		{
			printf("%-10s%-15s%-10s%-10s%-10s\n\n",stuname,stuid,stuchinese,stumath,stuenglish);	 
		}
		
		fclose(fp);
		printf("是否使用删除功能：是（1）/否（0）"); 
		scanf("%d",&flag);	
		if(flag==0)
		{   break;
			
		 } 
		else
		{
			deldate();
		}
		
		
	}
  
	
	
 } 
 //只有3次登陆机会
 void logtest()
 {  
 	static int i=3;	//用于测试用户输入多少次密码的静态变量
	--i;
	if(i==0)
	{	
		printf("\n3次都试不对 你怕是个铁憨憨哦\n\n") ; 
		exit(0);
	 } 
	printf("\n密码错误,你还有%d次输入机会！错3次有你好果汁吃！\n\n",i);
	
 	
  } 
//计算平均数
int avg()
{  
printf("正在开发中") ; 
} 
void deldate()
{
	char id[20];
	printf("请输入要删除数据的学号：");
	scanf("%s",&id);
	FILE *fp1,*fp2;
	
	
	
	if((fp1=fopen("d:/score.txt","r"))==NULL)
	{
		printf("打开错误！");
		system("pause");
		exit(0); 
	}
	
	char stuname[20];
 	char stuid[20];
 	char stuchinese[20];
 	char stumath[20];
 	char stuenglish[20];
	//向fp2中写入fp1中的内容 
	while(fscanf(fp1,"%s %s %s %s %s",stuname,stuid,stuchinese,stumath,stuenglish)!=EOF)
	{
		if(strcmp(id,stuid)==0)
		{
			continue;
		}
		if((fp2=fopen("d:/removscore.txt","a"))==NULL)
		
		{
			printf("添加失败");
			system("pause"); 
			exit(0);
		}
		fflush(stdin);
		fprintf(fp2,"%s %s %s %s %s\n",stuname,stuid,stuchinese,stumath,stuenglish);
		fflush(stdin);
		fclose(fp2); 
		
		
	}	 
	fclose(fp1);
	remove("d:/score.txt");
	rename("d:/removscore.txt","d:/score.txt");
	printf("删除成功");
	foread(); 
		 
} 

  
